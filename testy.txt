 
function sendMessage(isLoggedIn) {
    const message = {
        event: "auth_status",
        details: {
            isLoggedIn: isLoggedIn,
        },
        source: "game.netbet"
    };

    window.postMessage(message, "*");
}

function listenMessage() {
  const trustedOrigins = ["https://casino-promo.netbet.ro", "https://casino.netbet.ro"];
    window.addEventListener("message", function(event) {
        if (!trustedOrigins.includes(event.origin)) {
            console.warn("Untrusted origin:", event.origin);
            return;
        }
        const message = event.data;
        if (message.event === "auth_status") {
            console.log("Authentication status received:", message.details.isLoggedIn);
            if (message.details.isLoggedIn) {
                console.log("User is logged in.");
            } else {
                console.log("User is not logged in.");
            }
        }
    }, false);
}

listenMessage();
sendMessage(false);






function getCookie(name) {
  const nameEQ = name + "=";
  const ca = document.cookie.split(";");
  for (let i = 0; i < ca.length; i++) {
    let c = ca[i];
    while (c.charAt(0) === " ") {
      c = c.substring(1, c.length);
    }
    if (c.indexOf(nameEQ) === 0) {
      return c.substring(nameEQ.length, c.length);
    }
  }
  return null;
}

// Global variables
const token = "2f97bb641f2096c1e98a723c249a6ece";
const url = "https://admin.livepartners.com/api/streaming/";
const username = getCookie("netbet_login");
const cookie_id = getCookie("netbet_id");
const netbet_id = parseInt(cookie_id);

function sendMessageBasedOnCookies() {
    // Determine if the user is logged in based on the presence of username and netbet_id
    const isLoggedIn = !!(username && !isNaN(netbet_id));

    const message = {
        event: "auth_status",
        details: {
            isLoggedIn: isLoggedIn,
            username: username || null,  // Use global username
            netbet_id: netbet_id || null // Use global netbet_id
        },
        source: "game.netbet",
        token: token,   // Send global token
        api_url: url    // Send global url
    };

    // Send the message using window.postMessage
    window.postMessage(message, "*");
}

function listenMessage() {
    const trustedOrigins = ["https://casino-promo.netbet.ro", "https://casino.netbet.ro","https://login-ro.netbet.ro"];
    window.addEventListener("message", function(event) {
        if (!trustedOrigins.includes(event.origin)) {
            console.warn("Untrusted origin:", event.origin);
            return;
        }
        const message = event.data;
        if (message.event === "auth_status") {
            console.log("Authentication status received:", message.details.isLoggedIn);
            if (message.details.isLoggedIn) {
                console.log("User is logged in with username:", message.details.username);
            } else {
                console.log("User is not logged in.");
            }
        }
    }, false);
}

// Start listening for messages and send login status
listenMessage();
sendMessageBasedOnCookies();
